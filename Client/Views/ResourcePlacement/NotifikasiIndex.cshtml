@using System.Net.Http
@{
    ViewData["Title"] = "Notification";
}
@*<div class="card" style="width: 40%;">
    <img src="~/images/user.jpg" class="card-img-top" >
    <div class="container">
        <div class="row" id="cardNotification">
        </div>
    </div>
</div>*@
<div class="container-fluid py-4">
    <div class="page-header align-items-start min-vh-50 pt-5 pb-11 m-3 border-radius-lg" style="background-image: url('~/soft-ui/assets/img/curved-images/curved14.jpg');">
    @*<span class="mask bg-gradient-dark opacity-6"></span> *@ 
    <div class="row" id="notification-employee">
        <div class="col-lg-8">
            <div class="row">
                <div class="col-xl-6 mb-xl-0 mb-4">
                    <div class="card bg-transparent shadow-xl">
                        <div class="overflow-hidden position-relative border-radius-xl" style="background-image: url('~/soft-ui/assets/img/curved-images/curved14.jpg');">
                            <span class="mask bg-gradient-dark"></span>
                            <div class="card-body position-relative z-index-1 p-3">
                                <i class="fas fa-wifi text-white p-2"></i>
                                <h5 class="text-white mt-4 mb-5 pb-2">Hello Mr @User.FindFirst("Fullname").Value, You've Got Notification Interview</h5>
                                <div class="d-flex">
                                    <div class="d-flex">
                                        <div class="me-4">
                                            <p class="text-white text-sm opacity-8 mb-0">Company</p>
                                            <h6 class="text-white mb-0">Mitra Integrasi Informatika</h6>
                                        </div>
                                        <div>
                                            <p class="text-white text-sm opacity-8 mb-0">Join Date</p>
                                            <h6 class="text-white mb-0" id="createdDate"></h6>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xl-6">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card" style="background-color:#EBECF0">
                                <div class="card-header mx-4 p-3 text-center" style="background-color:#EBECF0">
                                    <div class="icon icon-shape icon-lg bg-gradient-primary shadow text-center border-radius-lg">
                                        <i class="fas fa-landmark opacity-10"></i>
                                    </div>
                                </div>
                                <div class="card-body pt-0 p-3 text-center">
                                    <h6 class="text-center mb-0">Client</h6>
                                    <hr class="horizontal dark my-3">
                                    <h5 class="mb-0" id="clientName"></h5>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 mt-md-0 mt-4">
                            <div class="card" style="background-color:#EBECF0">
                                <div class="card-header mx-4 p-3 text-center" style="background-color:#EBECF0">
                                    @*<span id="inputedInterview"></span>*@
                                    <div class="icon icon-shape icon-lg bg-gradient-primary shadow text-center border-radius-lg">
                                        <i class="fab fa-paypal opacity-10"></i>
                                    </div>
                                </div>
                                <div class="card-body pt-0 p-3 text-center">
                                    <h6 class="text-center mb-0">Position</h6>
                                    <hr class="horizontal dark my-3">
                                    <h5 class="mb-0" id="positionName"></h5>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-12 mb-lg-0 mb-4">
                    <div class="card mt-4" style="background-color:#EBECF0">
                        <div class="card-header pb-0 p-3" style="background-color:#EBECF0">
                            <div class="row">
                                <div class="col-6 d-flex align-items-center">
                                    <h6 class="mb-0">Interview Date</h6>
                                </div>
                                <div class="col-6 d-flex align-items-center">
                                    <h6 class="mb-0">Note</h6>
                                </div>
                            </div>
                        </div>
                        <div class="card-body p-3">
                            <div class="row">
                                <div class="col-md-6 mb-md-0 mb-4">
                                    <div class="card card-body border card-plain border-radius-lg d-flex align-items-center flex-row">
                                        @*<img class="w-10 me-3 mb-0" src="~/soft-ui/assets/img/logos/mastercard.png" alt="logo">*@
                                        <i class='bx bx-calendar-event me-3'></i>
                                        <h6 class="mb-0 mx-2" id="interviewDate"></h6>
                                        <i class="fas fa-pencil-alt ms-auto text-dark cursor-pointer" data-bs-toggle="tooltip" data-bs-placement="top" title="Edit Card"></i>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card card-body border card-plain border-radius-lg d-flex align-items-center flex-row">
                                        @*<img class="w-10 me-3 mb-0" src="~/soft-ui/assets/img/logos/visa.png" alt="logo">*@
                                        <i class='bx bx-notepad me-3'></i>
                                        <h6 class="mb-0 mx-2" id="note"></h6>
                                        <i class="fas fa-pencil-alt ms-auto text-dark cursor-pointer" data-bs-toggle="tooltip" data-bs-placement="top" title="Edit Card"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-4">
            <div class="card h-100" style="background-color:#EBECF0">
                <div class="card-header pb-0 p-3" style="background-color:#EBECF0">
                    <div class="row">
                        <div class="col-12 d-flex align-items-center">
                            <h6 class="mb-0">DO YOU WANT TO ATTEND IT?</h6>
                        </div>
                    </div>
                </div>
                <div class="card-body p-3 pb-0">
                    <ul class="list-group">
                        <li class="list-group-item border-0 d-flex justify-content-between ps-0 mb-2 border-radius-lg">
                            <div class="d-flex flex-column cursor-pointer" id="interviewAccepted" data-bs-placement="top" data-bs-custom-class="custom-tooltip" data-bs-title="@User.FindFirst("Fullname").Value Accept Interview Schedule">
                            </div>
                            <div class="d-flex align-items-center text-sm">
                                ACCEPT INTERVIEW SCHEDULE
                            </div>
                        </li>
                        <li class="list-group-item border-0 d-flex justify-content-between ps-0 mb-2 border-radius-lg">
                            <div class="d-flex flex-column cursor-pointer" id="interviewRejected" data-bs-placement="top" data-bs-custom-class="custom-tooltip" data-bs-title="@User.FindFirst("Fullname").Value Reject Schedule">
                            </div>
                            <div class="d-flex align-items-center text-sm">
                                REJECT INTERVIEW SCHEDULE
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
            
        
    </div>
        <div class="row" id="no-notification">
            <div class="col-1"></div>
            <div class="col-10 justify-content-center">
                <div class="card mb-3 border-warning" style="max-width:70%;">
                    <div class="row g-0">
                        <div class="col-md-4">
                            <img src="https://cdn-icons-png.flaticon.com/512/4610/4610214.png" class="img-fluid rounded-start  my-auto" alt="...">
                        </div>
                        <div class="col-md-8">
                            <div class="card-body">
                                <h5 class="card-title">Hello Mr @User.FindFirst("Fullname").Value</h5>
                                <p class="card-text">There is no Notification Interview now but please always check this page later</p>
                                <p class="card-text"><small class="text-body-secondary">You Have see this Page at @DateTime.Now</small></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-1"></div>
        </div>
    </div>
</div>
<div class="modal" id="modalUpdateComment" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Update</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="mb-3">
                        <label for="comment" class="form-label">Comment</label>
                        <input type="text" class="form-control" id="commentUpd" placeholder="comment">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" onclick="interviewRejected('@User.FindFirst("Guid").Value')" class="btn btn-primary d-inline-block" data-bs-dismiss="modal">Send Comment</button>
                <button type="button" class="btn btn-secondary d-inline-block" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
@section Scripts
{
    <script>
        const Token = '@Context.Session.GetString("JWToken")'
         $( document ).ajaxComplete(function() {
            $('[data-bs-placement="top"]').tooltip({
                "html": true,
                "delay": {"show": 200, "hide": 0},
            });
            const tooltipTriggerList = document.querySelectorAll('[data-bs-placement="top"]')
            const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
        });
        $(document).ready(()=>{
            $.ajax({
                url: "https://localhost:7273/api/employees/GetEmployeeNotification/@User.FindFirst("Guid").Value",
                headers: {
                    'Authorization': 'Bearer ' + Token
                }
            }).done((result) => {
                console.log(result.data)
                if (result.data == null) {
                    $("#notification-employee").hide();
                    $("#no-notification").show();
                }
                else {
                    $("#notification-employee").show();
                    $("#no-notification").hide();

                    console.log(result)
                    $('#inputedInterview').html(`<input type="hidden" value="${result.data.clientGuid}" id="clientUpd"/>
                                        <input type="hidden" value="${result.data.interviewDate}" id="interviewDateUpd"/>
                                        <input type="hidden" value="${result.data.note}" id="noteUpd"/>`)
                    createdDate = result.data.createdDate != null ? moment($("#createdDate").val(result.data.createdDate)).format("dddd, D MMMM YYYY, HH:mm") : null;
                    interviewDate = result.data.interviewDate != null ? moment($("#interviewDate").val(result.data.interviewDate)).format("dddd, D MMMM YYYY, HH:mm") : null;
                    $('#createdDate').html(`${result.data.createdDate != null ? moment(result.data.createdDate).format("dddd, D MMMM YYYY, HH:mm") : null}`)
                    $('#clientName').html(`${result.data.clientName}`)
                    $('#positionName').html(`${result.data.positionName}`)
                    $('#note').html(`${result.data.note}`)
                    $('#interviewAccepted').html(`<a onclick="interviewAccepted('@User.FindFirst("Guid").Value')"><box-icon name='check' color="green" size="lg"></box-icon></a>`)
                    $('#interviewRejected').html(`<a data-bs-toggle="modal" data-bs-target="#modalUpdateComment"><box-icon name='x' color="red" size="lg"></box-icon></a>`)
                    $('#interviewDate').html(`${result.data.interviewDate != null ? moment(result.data.interviewDate).format("dddd, D MMMM YYYY, HH:mm") : null}`)
                }

            }).fail((error) => {
                console.log(error)
                $("#notification-employee").hide();
                $("#no-notification").show();
            })
        })
        
        function interviewAccepted(guidEmployee){
            let data = {
                guid : guidEmployee,
                comment : null,
                isAccepted : false,
                status : 1,
            }
            $.ajax({
                url : "https://localhost:7273/api/interviews/UpdateFullInterview",
                type: "PUT",
                contentType: "application/json",
                data: JSON.stringify(data),
                headers: {
                    'Authorization': 'Bearer ' + Token
                }
            }).done((result) => {
                Swal.fire({
                    title: 'Success',
                    text: 'Data Interview has been successfully updated',
                    icon: 'success'
                }).then(function () {
                    location.reload();
                });
            }).fail((error) => {
                Swal.fire({
                    icon: 'error',
                    title: 'Oops...',
                    text: 'Failed to Updated data Interview! Please try again.'
                })
                console.log(error)
            })
        }
        function interviewRejected(guidEmployee){
            let data = {
                guid : guidEmployee,
                isAccepted : false,
                comment: $("#commentUpd").val(),
                status : 2,
            }
            $.ajax({
                url : "https://localhost:7273/api/interviews/UpdateFullInterview",
                headers: {
                    'Authorization': 'Bearer ' + Token
                },
                type: "PUT",
                contentType: "application/json",
                data: JSON.stringify(data)
            }).done((result) => {
                Swal.fire({
                    title: 'Success',
                    text: 'Data Interview has been successfully updated',
                    icon: 'success'
                }).then(function () {
                    location.reload();
                });
            }).fail((error) => {
                Swal.fire({
                    icon: 'error',
                    title: 'Oops...',
                    text: 'Failed to Updated data Interview! Please try again.'
                })
                console.log(error)
            })
        }    
        
    </script>
}